<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Coach Virtual Pro</title>

<style>
body {
    margin: 0;
    font-family: 'Segoe UI', sans-serif;
    background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
    color: white;
}

.main { display: flex; min-height: 100vh; }

.left, .right { flex: 1; padding: 30px; }

.left { border-right: 1px solid rgba(255,255,255,0.1); }

.card {
    background: rgba(255,255,255,0.08);
    padding: 20px;
    border-radius: 15px;
    backdrop-filter: blur(10px);
    margin-bottom: 20px;
}

h1 { margin-top: 0; }

label { display: block; margin-top: 12px; }

input, select {
    width: 100%;
    padding: 8px;
    margin-top: 5px;
    border-radius: 8px;
    border: none;
    font-size: 16px;
}

button {
    width: 100%;
    padding: 12px;
    margin-top: 12px;
    border-radius: 10px;
    border: none;
    font-size: 16px;
    cursor: pointer;
    background: #ff3b3b;
    color: white;
    font-weight: bold;
    transition: 0.2s;
}

button:hover {
    background: #ff1f1f;
    transform: scale(1.02);
}

.timer {
    font-size: 60px;
    text-align: center;
    margin: 20px 0;
}

.status {
    text-align: center;
    font-size: 20px;
    opacity: 0.8;
}

.ranking-entry {
    padding: 6px 0;
    border-bottom: 1px solid rgba(255,255,255,0.1);
}

.ranking-active {
    background:#cc2f2f !important;
}

@keyframes medalGlow {
    from { transform: scale(1); }
    to { transform: scale(1.2); }
}

@keyframes medalPulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.3); }
    100% { transform: scale(1); }
}@keyframes medalPulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.3); }
    100% { transform: scale(1); }
}

/* üîî CAMPANA */
.bell-animation {
    position: fixed !important;
    top: 40%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 170px;
    display: none;
    z-index: 99999;
    pointer-events: none;
    animation: ring 0.7s ease-in-out 5;
}

@keyframes ring {
    0% { transform: translate(-50%, -50%) rotate(0deg); }
    25% { transform: translate(-50%, -50%) rotate(25deg); }
    50% { transform: translate(-50%, -50%) rotate(-25deg); }
    75% { transform: translate(-50%, -50%) rotate(15deg); }
    100% { transform: translate(-50%, -50%) rotate(0deg); }
}

@media (max-width: 900px) {
    .main { flex-direction: column; }
    .left { border-right: none; border-bottom: 1px solid rgba(255,255,255,0.1); }
}
</style>
</head>

<body>

<div class="bell-animation" id="bellAnim">üîî</div>

<div class="main">

<div class="left">
<h1>‚öô Ajustes</h1>

<div class="card">

<label>Rounds</label>
<input type="number" id="rounds" value="3" min="1">

<label>Duraci√≥n Round (mm:ss)</label>
<input type="text" id="roundTime" value="3:00" placeholder="ej: 3:20">

<label>Descanso (mm:ss)</label>
<input type="text" id="restTime" value="1:00" placeholder="ej: 1:30">

<label>Velocidad inicial voz</label>
<input type="number" id="speed" value="1" step="0.1" min="1">>

<label>Volumen Campana</label>
<input type="range" id="volumeControl" min="0" max="1" step="0.1" value="0.4">

<label>Volumen Voz</label>
<input type="range" id="voiceVolume" min="0" max="1" step="0.1" value="1">

<label style="display:flex; align-items:center; gap:6px;">
    Modo
    <span id="modeInfoIcon" style="
        cursor:pointer;
        font-size:14px;
        background:rgba(255,255,255,0.15);
        padding:2px 6px;
        border-radius:50%;
        transition:0.2s;
    ">‚ÑπÔ∏è</span>
</label>

<select id="modeSelect">
<option value="normal">Normal</option>
<option value="sparring">Sparring Impredecible Real</option>
<option value="intensity">Intensidad</option>
</select>

    <div id="modeTooltip" style="
        position:relative;
        margin-top:8px;
        font-size:13px;
        opacity:0;
        transform:translateY(-5px);
        transition:0.25s;
        line-height:1.4;
        background:rgba(0,0,0,0.35);
        padding:8px 10px;
        border-radius:8px;
    "></div>
    
<label>Voz</label>
<select id="voiceSelect"></select>

</div>
</div>

<div class="right">
<h1>ü•ä Entrenamiento</h1>

<div class="card">
<button onclick="startTraining()">COMENZAR</button>
<button onclick="pauseTraining()">PAUSAR</button>
<button onclick="resumeTraining()">REANUDAR</button>
<button onclick="stopTraining()">DETENER</button>
</div>

<div class="card">
<div class="timer" id="timer">00:00</div>
<div class="status" id="status">Esperando...</div>
</div>

<div class="card">

<div style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap;">
    <h3 id="rankingTitle" style="margin:0;">üèÜ Ranking (Top 5)</h3>
    <div id="rankingFilters" style="display:flex; gap:6px;"></div>
</div>

<div id="rankingList" style="margin-top:15px;"></div>

</div>

</div>
</div>

<script>
const palabras=["izquierda","derecha","esquive","gancho","cross","atr√°s","adelante"];

let training=false, paused=false;
let currentRound=1, totalRounds=0;
let baseRoundDuration=0, baseRestDuration=0;
let roundDuration=0, restDuration=0;
let remainingSeconds=0;
let isRoundPhase=true;
let totalSecondsTrained=0;
let selectedVoice=null;
let mode="normal";

/* üîä CAMPANA LOCAL */
const bell=new Audio();
bell.src="Sonidos/campana.mp3";
bell.preload="auto";

function playBell(){
    bell.volume=document.getElementById("volumeControl").value;
    bell.currentTime=0;
    bell.load();
    bell.play().catch(()=>{});
    animateBell();
    if(navigator.vibrate) navigator.vibrate([200,100,200]);
}

function animateBell(){
    const el=document.getElementById("bellAnim");
    el.style.display="block";
    setTimeout(()=>el.style.display="none",1800);
}

function loadVoices(){
    const voices=speechSynthesis.getVoices();
    const select=document.getElementById("voiceSelect");
    select.innerHTML="";
    voices.filter(v=>v.lang.includes("es")).forEach(v=>{
        const option=document.createElement("option");
        option.value=v.name;
        option.textContent=v.name;
        select.appendChild(option);
    });
    selectedVoice=voices.find(v=>v.name===select.value);
}
speechSynthesis.onvoiceschanged=loadVoices;

document.getElementById("voiceSelect").addEventListener("change",()=>{
    const voices=speechSynthesis.getVoices();
    selectedVoice=voices.find(v=>v.name===document.getElementById("voiceSelect").value);
});

function speak(text,rate){
    if(!training || paused) return;
    const u=new SpeechSynthesisUtterance(text);
    u.voice=selectedVoice;
    u.rate=rate;
    u.pitch=0.9;
    u.volume=parseFloat(document.getElementById("voiceVolume").value);
    speechSynthesis.speak(u);
}

function formatTime(sec){
    return `${Math.floor(sec/60).toString().padStart(2,'0')}:${(sec%60).toString().padStart(2,'0')}`;
}

function randomCombo(){
    let length=Math.floor(Math.random()*3)+1;
    let combo=[];
    for(let i=0;i<length;i++){
        combo.push(palabras[Math.floor(Math.random()*palabras.length)]);
    }
    return combo.join(" ");
}

function randomBetween(min,max){
    return Math.floor(Math.random()*(max-min+1)+min);
}

async function runTimer(){
    let baseRate = Math.max(1, parseFloat(document.getElementById("speed").value) || 1);
    let rate=baseRate;

    if(mode==="intensity"){
        rate+=currentRound*0.1;
        restDuration=Math.max(10,baseRestDuration-currentRound*5);
    }

    playBell();

    while(training && remainingSeconds>0){

        if(paused){
            await new Promise(r=>setTimeout(r,200));
            continue;
        }

        document.getElementById("timer").innerText=formatTime(remainingSeconds);

        if(isRoundPhase){

            let speakFrequency=2;
            if(mode==="intensity") speakFrequency=1;

            if(remainingSeconds%speakFrequency===0){
                speak(randomCombo(),rate);
            }

            if(mode==="sparring" && Math.random()<0.12){
                speak("Ritmo alto!",rate+0.2);
            }
        }

        await new Promise(r=>setTimeout(r,1000));
        remainingSeconds--;
    }

    if(training){
        playBell();

        if(isRoundPhase){
            totalSecondsTrained+=roundDuration;

            if(currentRound<totalRounds){
                isRoundPhase=false;
                remainingSeconds=restDuration;
                document.getElementById("status").innerText="DESCANSO";
                await runTimer();
            }else{
                training=false;
                document.getElementById("status").innerText="Finalizado";
                saveRanking(totalRounds,Math.floor(totalSecondsTrained/60));
            }
        }else{
            isRoundPhase=true;
            currentRound++;

            if(mode==="sparring"){
                roundDuration=randomBetween(baseRoundDuration-15,baseRoundDuration+15);
            } else {
                roundDuration=baseRoundDuration;
            }

            remainingSeconds=roundDuration;
            document.getElementById("status").innerText="ROUND "+currentRound;
            await runTimer();
        }
    }
}

    
function parseTimeToSeconds(timeString){

    if(!timeString) return 0;

    if(!timeString.includes(":")){
        const minutes = Math.max(0, parseInt(timeString) || 0);
        return minutes * 60;
    }

    const parts = timeString.split(":");

    const minutes = Math.max(0, parseInt(parts[0]) || 0);
    const seconds = Math.max(0, parseInt(parts[1]) || 0);

    return (minutes * 60) + seconds;
}


function formatInputTime(inputId){
    const input = document.getElementById(inputId);
    input.addEventListener("blur", ()=>{

        const total = parseTimeToSeconds(input.value);
        const min = Math.floor(total/60);
        const sec = total%60;

        input.value = `${min}:${sec.toString().padStart(2,'0')}`;
    });
}

formatInputTime("roundTime");
formatInputTime("restTime");

    
function startTraining(){
    if(training) return;

    training=true;
    paused=false;
    mode=document.getElementById("modeSelect").value;

    totalRounds = Math.max(1, parseInt(document.getElementById("rounds").value) || 1);
    baseRoundDuration = parseTimeToSeconds(document.getElementById("roundTime").value);
    baseRestDuration = parseTimeToSeconds(document.getElementById("restTime").value);

    roundDuration=baseRoundDuration;
    restDuration=baseRestDuration;

    currentRound=1;
    isRoundPhase=true;
    remainingSeconds=roundDuration;
    totalSecondsTrained=0;

    document.getElementById("status").innerText="ROUND 1";
    runTimer();
}

function pauseTraining(){ paused=true; speechSynthesis.cancel(); }
function resumeTraining(){ paused=false; }
function stopTraining(){

    training = false;
    paused = false;

    speechSynthesis.cancel();

    // üîÅ Reset completo
    currentRound = 1;
    remainingSeconds = 0;
    totalSecondsTrained = 0;
    isRoundPhase = true;

    document.getElementById("timer").innerText = "00:00";
    document.getElementById("status").innerText = "Detenido";
}

/* üèÜ RANKING */

/* ================= INTENSIDAD REAL ================= */
function calculateIntensity(rounds, minutes, mode){
    let modeMultiplier = 0;

    if(mode === "sparring") modeMultiplier = 40;
    if(mode === "intensity") modeMultiplier = 60;

    return Math.round(
        (minutes * 10) +
        (rounds * 20) +
        modeMultiplier
    );
}

function saveRanking(rounds,minutes){
    let history = JSON.parse(localStorage.getItem("boxingHistory")) || [];

    const points = calculateIntensity(rounds, minutes, mode);

    history.push({
        date: new Date().toLocaleDateString(),
        rounds,
        minutes,
        mode,
        points
    });

    localStorage.setItem("boxingHistory", JSON.stringify(history));
    loadRanking();
}

function loadRanking(){

    let history = JSON.parse(localStorage.getItem("boxingHistory")) || [];
    const list = document.getElementById("rankingList");
    const filters = document.getElementById("rankingFilters");

    list.innerHTML = "";
    filters.innerHTML = "";

    // ‚ùå SACAMOS "points"
    const modes = ["all","normal","sparring","intensity"];

    const savedFilter = localStorage.getItem("rankingFilter") || "all";

    modes.forEach(m=>{
        const btn = document.createElement("button");
        btn.innerText = m.toUpperCase();
        btn.style.padding="6px 10px";
        btn.style.fontSize="12px";
        btn.style.width="auto";
        btn.style.margin="0";
        btn.dataset.mode = m;

        if(m === savedFilter){
            btn.classList.add("ranking-active");
        }

        btn.onclick = ()=>filterRanking(m);
        filters.appendChild(btn);
    });

    filterRanking(savedFilter);
}

function filterRanking(selectedMode){

    localStorage.setItem("rankingFilter", selectedMode);

    let history = JSON.parse(localStorage.getItem("boxingHistory")) || [];
    const container = document.getElementById("rankingList");

    const title = document.getElementById("rankingTitle");

if(selectedMode === "all"){
    title.innerText = "üèÜ Ranking (Top 10)";
} else {
    title.innerText = "üèÜ Ranking (Top 5)";
}

    container.style.opacity = "0";
    container.style.transform = "translateY(5px)";

    setTimeout(()=>{

        document.querySelectorAll("#rankingFilters button").forEach(btn=>{
            btn.classList.remove("ranking-active");
            if(btn.dataset.mode === selectedMode){
                btn.classList.add("ranking-active");
            }
        });

        let filtered = [...history];

        // üî• FILTRO POR MODO (menos ALL)
        if(selectedMode !== "all"){
            filtered = filtered.filter(e => e.mode === selectedMode);
        }

        // üß† ORDEN INTELIGENTE
        filtered.sort((a,b)=>{

            const pointsA = a.points || 0;
            const pointsB = b.points || 0;

            // 1Ô∏è‚É£ Primero por puntos reales
            if(pointsB !== pointsA){
                return pointsB - pointsA;
            }

            // 2Ô∏è‚É£ Si empatan ‚Üí por minutos
            return b.minutes - a.minutes;
        });

        // Top 5
        if(selectedMode === "all"){
              filtered = filtered.slice(0,10);
          } else {
              filtered = filtered.slice(0,5);
          }

        container.innerHTML = "";

        if(filtered.length === 0){
            container.innerHTML = "<div class='ranking-entry'>Sin registros</div>";
        } else {

            filtered.forEach((e,index)=>{

                let medal = "";

                if(index === 0){
                    medal = `<span style="
                        font-size:22px;
                        margin-right:6px;
                        animation: medalPulse 1s infinite;
                    ">ü•á</span>`;
                }

                if(index === 1){
                    medal = `<span style="
                        font-size:20px;
                        margin-right:6px;
                        opacity:0.9;
                    ">ü•à</span>`;
                }

                if(index === 2){
                    medal = `<span style="
                        font-size:20px;
                        margin-right:6px;
                        opacity:0.85;
                    ">ü•â</span>`;
                }

                container.innerHTML += `
                <div class="ranking-entry">
                    ${medal}
                    ${e.date} - ${e.rounds} rounds - ${e.minutes} min - ${e.points || 0} pts
                </div>`;
            });
        }

        container.style.opacity = "1";
        container.style.transform = "translateY(0px)";

    },150);
}

loadRanking();

    
const modeIcon = document.getElementById("modeInfoIcon");
const modeTooltip = document.getElementById("modeTooltip");
const modeSelect = document.getElementById("modeSelect");

const modeDescriptions = {
    normal: "Modo cl√°sico: combinaciones estables y ritmo constante.",
    sparring: "Modo impredecible: duraci√≥n variable y presi√≥n aleatoria.",
    intensity: "Modo progresivo: cada round aumenta velocidad y reduce descanso."
};

function showModeTooltip(){
    const selected = modeSelect.value;
    modeTooltip.innerText = modeDescriptions[selected] || "";
    modeTooltip.style.opacity = "1";
    modeTooltip.style.transform = "translateY(0px)";
}

function hideModeTooltip(){
    modeTooltip.style.opacity = "0";
    modeTooltip.style.transform = "translateY(-5px)";
}

// PC hover
modeIcon.addEventListener("mouseenter", showModeTooltip);
modeIcon.addEventListener("mouseleave", hideModeTooltip);

// Celular tap
modeIcon.addEventListener("click", (e)=>{
    e.stopPropagation();
    if(modeTooltip.style.opacity === "1"){
        hideModeTooltip();
    } else {
        showModeTooltip();
    }
});

// Cerrar si se toca afuera
document.addEventListener("click", (e)=>{
    if(!modeIcon.contains(e.target)){
        hideModeTooltip();
    }
});

    
</script>

</body>
</html>







